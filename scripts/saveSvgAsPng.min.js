(function(a){if(typeof define==="function"&&define.amd){define(["JSRootPainter"],a)}else{if(typeof JSROOT=="undefined"){throw new Error("JSROOT is not defined","saveSvgAsPng.js")}a(JSROOT)}}(function(d){var c='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">';function g(i){return i&&i.lastIndexOf("http",0)==0&&i.lastIndexOf(window.location.host)==-1}function b(l,n){var j=l.querySelectorAll("image");var m=j.length;if(m==0){n()}for(var k=0;k<j.length;k++){(function(r){var p=r.getAttributeNS("http://www.w3.org/1999/xlink","href");if(p){if(g(p.value)){console.warn("Cannot render embedded images linking to external hosts: "+p.value);return}}var q=document.createElement("canvas");var i=q.getContext("2d");var o=new Image();p=p||r.getAttribute("href");o.src=p;o.onload=function(){q.width=o.width;q.height=o.height;i.drawImage(o,0,0);r.setAttributeNS("http://www.w3.org/1999/xlink","href",q.toDataURL("image/png"));m--;if(m==0){n()}};o.onerror=function(){console.log("Could not load "+p);m--;if(m==0){n()}}})(j[k])}}function h(k,l){var s="";var r=document.styleSheets;for(var p=0;p<r.length;p++){try{var v=r[p].cssRules}catch(t){console.warn("Stylesheet could not be loaded: "+r[p].href);continue}if(v!=null){for(var o=0;o<v.length;o++){var u=v[o];if(typeof(u.style)!="undefined"){var q=null;try{q=k.querySelector(u.selectorText)}catch(n){console.warn('Invalid CSS selector "'+u.selectorText+'"',n)}if(q){var m=l?l(u.selectorText):u.selectorText;s+=m+" { "+u.style.cssText+" }\n"}else{if(u.cssText.match(/^@font-face/)){s+=u.cssText+"\n"}}}}}}return s}function f(j,l,k){var i=(j.viewBox.baseVal&&j.viewBox.baseVal[k])||(l.getAttribute(k)!==null&&!l.getAttribute(k).match(/%$/)&&parseInt(l.getAttribute(k)))||j.getBoundingClientRect()[k]||parseInt(l.style[k])||parseInt(window.getComputedStyle(j).getPropertyValue(k));return(typeof i==="undefined"||i===null||isNaN(parseFloat(i)))?0:i}function e(i){i=encodeURIComponent(i);i=i.replace(/%([0-9A-F]{2})/g,function(j,k){var l=String.fromCharCode("0x"+k);return l==="%"?"%25":l});return decodeURIComponent(i)}function a(k,j,i){j=j||{};j.scale=j.scale||1;var l="http://www.w3.org/2000/xmlns/";b(k,function(){var v=document.createElement("div");var t=k.cloneNode(true);var m,u;if(k.tagName=="svg"){m=j.width||f(k,t,"width");u=j.height||f(k,t,"height")}else{if(k.getBBox){var p=k.getBBox();m=p.width;u=p.height;t.setAttribute("transform","translate("+(-p.x)+","+(-p.y)+")");var q=document.createElementNS("http://www.w3.org/2000/svg","svg");q.appendChild(t);t=q}else{console.error("Attempted to render non-SVG element",k);return}}t.setAttribute("version","1.1");t.setAttributeNS(l,"xmlns","http://www.w3.org/2000/svg");t.setAttributeNS(l,"xmlns:xlink","http://www.w3.org/1999/xlink");t.setAttribute("width",m*j.scale);t.setAttribute("height",u*j.scale);t.setAttribute("viewBox",[j.left||0,j.top||0,m,u].join(" "));v.appendChild(t);var r=h(k,j.selectorRemap);var w=document.createElement("style");w.setAttribute("type","text/css");w.innerHTML="<![CDATA[\n"+r+"\n]]>";var o=document.createElement("defs");o.appendChild(w);t.insertBefore(o,t.firstChild);var q=c+v.innerHTML;var n="data:image/svg+xml;base64,"+window.btoa(e(q));if(i){i(n)}})}d.saveSvgAsPng=function(j,i,k){i=i||{};a(j,i,function(l){var m=new Image();m.onload=function(){if(i.result==="image"){return d.CallBack(k,m)}var o=document.createElement("canvas");o.width=m.width;o.height=m.height;var p=o.getContext("2d");if(i&&i.backgroundColor){p.fillStyle=i.backgroundColor;p.fillRect(0,0,o.width,o.height)}p.drawImage(m,0,0);if(i.result==="canvas"){return d.CallBack(k,o)}var n=document.createElement("a");n.download=i.name||"file.png";n.href=o.toDataURL("image/png");document.body.appendChild(n);n.addEventListener("click",function(q){n.parentNode.removeChild(n);d.CallBack(k,true)});n.click()};m.src=l})};return d.Painter}));